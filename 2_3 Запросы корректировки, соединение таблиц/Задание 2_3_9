/* –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤ —É–¥–∞–ª—è–µ–º—ã—Ö –∫–Ω–∏–≥ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º */

-- üì¶ –®–ê–ì 1: –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É-–∞—Ä—Ö–∏–≤ –¥–ª—è —É–¥–∞–ª—è–µ–º—ã—Ö –∫–Ω–∏–≥
CREATE TABLE IF NOT EXISTS book_archive (
    archive_id INT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(255),
    author_name VARCHAR(255),
    price DECIMAL(8,2),
    amount INT,
    archive_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- üì• –®–ê–ì 2: –ê—Ä—Ö–∏–≤–∏—Ä—É–µ–º –∫–Ω–∏–≥–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ supply
INSERT INTO book_archive (title, author_name, price, amount)
SELECT
    b.title,
    a.name_author,
    b.price,
    b.amount
FROM
    book b
    INNER JOIN author a ON b.author_id = a.author_id
WHERE
    (b.title, a.name_author) NOT IN (
        SELECT title, author FROM supply
    );

-- üóëÔ∏è –®–ê–ì 3: –£–¥–∞–ª—è–µ–º –∫–Ω–∏–≥–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ supply
DELETE b FROM book b
INNER JOIN author a ON b.author_id = a.author_id
LEFT JOIN supply s ON b.title = s.title AND a.name_author = s.author
WHERE s.supply_id IS NULL;

-- üëÄ –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∞—Ä—Ö–∏–≤–∞
SELECT * FROM book_archive;

-- üìä –®–ê–ì 5: –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–Ω–∏–≥–∏ –≤ book
SELECT * FROM book;

-- üîç –®–ê–ì 6: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ supply
SELECT * FROM supply;
